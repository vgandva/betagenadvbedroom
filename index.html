<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marzipano VR with Hotspots</title>
    <script src="https://www.marzipano.net/dist/marzipano.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #vr-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px;
            background-color: #000;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            z-index: 10;
        }
        .hotspot {
            position: absolute;
            width: 30px;
            height: 30px;
            background: url('hotspot_icon.png') no-repeat center center;
            background-size: cover;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="vr-button">Enter VR</div>
    <div id="pano"></div>

    <script>
        var viewer = new Marzipano.Viewer(document.getElementById('pano'));
        var stage = viewer.stage();

        var sceneData = [
            { id: 'livingroom', image: 'livingroom.jpg', hotspots: [
                { position: { yaw: 1, pitch: 1 }, scene: 'bedroom' },
                { position: { yaw: -1, pitch: 1 }, scene: 'kitchen' }
            ]},
            { id: 'kitchen', image: 'kitchen.jpg', hotspots: [
                { position: { yaw: 1, pitch: 1 }, scene: 'livingroom' }
            ]},
            { id: 'bedroom', image: 'bedroom.jpg', hotspots: [
                { position: { yaw: -1, pitch: 1 }, scene: 'livingroom' }
            ]}
        ];

        var currentScene = sceneData[0]; // default to living room

        function loadScene(scene) {
            currentScene = scene;
            var source = Marzipano.ImageUrlSource.fromString(scene.image);
            var geometry = new Marzipano.CubeGeometry([{ tileSize: 512, size: 1024 }]);
            var view = new Marzipano.RectilinearView();

            var pano = viewer.createScene({ source: source, geometry: geometry, view: view });
            stage.clear();
            pano.mount();
            createHotspots(pano, scene.hotspots);
        }

        function createHotspots(pano, hotspots) {
            hotspots.forEach(function(hotspot) {
                var hotspotDiv = document.createElement('div');
                hotspotDiv.className = 'hotspot';
                pano.addHotspot(hotspotDiv, new Marzipano.EquirectangularCoordinates(hotspot.position.yaw, hotspot.position.pitch));

                hotspotDiv.addEventListener('click', function() {
                    var nextScene = sceneData.find(function(scene) {
                        return scene.id === hotspot.scene;
                    });
                    if (nextScene) {
                        loadScene(nextScene);
                    }
                });
            });
        }

        document.getElementById('vr-button').addEventListener('click', function() {
            viewer.enterVR();
        });

        // Initial scene load
        loadScene(currentScene);

    </script>
</body>
</html>
